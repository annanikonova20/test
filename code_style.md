# Стиль кода

* [Использование макросов](./Стиль-кода-на-Qt-C--#макросы)
* [Отступы](./Стиль-кода-на-Qt-C--#отступы)
* [Подключение заголовочных файлов](./Стиль-кода-на-Qt-C--#подключение-заголовочных-файлов)
* [Объявление переменных](./Стиль-кода-на-Qt-C--#объявление-переменных)
* [Именованные константы](./Стиль-кода-на-Qt-C--#именованные-константы)
* [Пробелы](./Стиль-кода-на-Qt-C--#пробелы)
* [Фигурные скобки](./Стиль-кода-на-Qt-C--#фигурные-скобки)
* [Круглые скобки](./Стиль-кода-на-Qt-C--#круглые-скобки)
* [Использование перечислений enum](./Стиль-кода-на-Qt-C--#использование-перечислений-enum)
* [Использование конструкции switch](./Стиль-кода-на-Qt-C--#использование-конструкции-switch)
* [Операторы перехода (break, continue, return и goto)](./Стиль-кода-на-Qt-C--#операторы-перехода-(break,-continue,-return-и-goto))
* [Разрыв строк](./Стиль-кода-на-Qt-C--#разрыв-строк)
* [Наследование и ключевое слово virtual](./Стиль-кода-на-Qt-C--#наследование-и-ключевое-слово-virtual)



Ниже представлен обзор соглашений по написанию кода с использованием Qt. Эта информация была собрана здесь из разных источников: документации по Qt, тематических форумов, e-mail списков рассылки и опыта различных разработчиков.

## Макросы

* Запрещено использовать макросы, за исключение случаев, когда без этого нельзя написать код стандартными функциями языка C++ или фреймворка Qt. Любое использование макросов должно обсуждаться разработчиками совместно.

Не надо объявлять нетипизированные константы в виде #define

```cpp
 // Неправильно
#define STCROOT "stc"

 // Правильно
static const auto STCROOT = QLatin1String("stc");
```

## Отступы

* Для обозначения отступа используйте 4 пробела подряд
* Используйте пробелы, а не табуляцию!

## Подключение заголовочных файлов

В общем случае последовательность такая:
1. Qt-шные системные файлы;
2. c-style заголовочные файлы, например от внешних библиотек;
3. заголовочные файлы стандартной библиотеки c++;
4. свои заголовочные файлы.

```cpp

#include <QCoreApplication> // Qt
#include <cmath> // c-style
#include <memory> // c++ stl
#include "userheader.h" // пользовательский заголовочный файл

```

Примечание. Данная последовательность рекомендована в справке Qt на официальном сайте. Ранее в проекте использовалась последовательность и Qt-шные заголовочные файлы стояли шли 3-м пунктом. Подключение Qt-шных заголовочных файлов делаем без указания модулей Qt, для более простой смены версий Qt:

```cpp

// неправильно
#include <QtCore/QSettings>

// правильно
#include <QSettings>
```

## Объявление переменных

* Объявляйте каждую переменную в новой строке.
* Избегайте, если это возможно, коротких и запутанных названий переменных (Например: "a", "rbarr", "nughdeget").
* Односимвольные имена переменных подходят только для итераторов циклов, небольшого локального контекста и временных переменных. В остальных случаях имя переменной должно отражать ее назначение.
* Заводите переменные только по мере необходимости.

```cpp
 // Неправильно
 int a, b;
 char *c, *d;

 // Правильно
 int height;
 int width;
 char *nameOfThis;
 char *nameOfThat;

```

* Функции и переменные должны именоваться со строчной буквы. Каждое последующие слово в имени переменной должно начинаться с прописной буквы.

* Избегайте аббревиатур

```cpp
 // Неправильно
 short Cntr;
 char ITEM_DELIM = ' ';

 // Правильно
 short counter;
 char itemDelimiter = ' ';

```

* Имена классов всегда начинаются с заглавной буквы. Public-классы начинаются с буквы 'Q' (QRgb). Public-функции должны начинаться с прописной буквы 'q' (qRgb).
* Сокращения в стиле  Camel. (e.g. QXmlStreamReader, not QXMLStreamReader).

## Именованные константы

* Все буквы заглавные с разделителем в виде знака _(подчеркивание):

```cpp
static const int MY_GREAT_CONSTANT = 1;
```


## Пробелы

* Используйте пустые строки для логической группировки операторов, где это возможно.
* Всегда используйте одну пустую строку в качестве разделителя
* Всегда используйте один пробел перед фигурной скобкой

```cpp
 // Неправильно
 if(foo){
 }

 // Правильно
 if (foo) {
 }
```

* Для указателей и ссылок всегда ставьте один пробел после '*' или '&', если они стоят перед описанием типов. Но никогда не ставьте пробелы между '*' или '&' и именем переменной.

```cpp
 char *x;
 const QString &myString;
 const char * const y = "hello";
```

* Бинарные операции отделяются пробелами с двух сторон.
* Оставьте пробел после каждой запятой
* После приведения типа, используя конструкции cast, не ставьте пробелов.
* Избегайте преобразования типов в стиле C.

```cpp
 // Неправильно
 char* blockOfMemory = (char* ) malloc(data.size());

 // Правильно
 char *blockOfMemory = reinterpret_cast<char *>(malloc(data.size()));
```

* Не используйте несколько операторов на одной строке
* По возможности, используйте новую строку для тела оператора ветвления:

```cpp
 // Неправильно
 if (foo) bar();

 // Правильно
 if (foo)
     bar();
```


## Фигурные скобки

* Используйте прикрепленные скобки: открывающая скобка идет по той же линии, что и начало инструкции. Если за закрывающей скобкой следует другое ключевое слово, то оно также попадает в ту же строку:

```cpp
 // Неправильно
 if (codec)
 {
 }
 else
 {
 }

 // Правильно
 if (codec) {
 } else {
 }
```

* Исключение: Тело функции, лябда и описание класса всегда открывается фигурной скобкой, стоящей на новой строке:

```cpp
 static void foo(int g)
 {
     qDebug("foo: %i", g);
 }

 connect(pointerToEmitter, &emitterSignal, pointerToLambdaContext, []()
 {
    // тело лямбды
 });

 class Moo
 {
 };

```


* Используйте фигурные скобки только в том случае, если тело условного оператора содержит более одной строки:

```cpp
 // Неправильно
 if (address.isEmpty()) {
     return false;
 }

 for (int i = 0; i < 10; ++i) {
     qDebug("%i", i);
 }

 // Правильно
 if (address.isEmpty())
     return false;

 for (int i = 0; i < 10; ++i)
     qDebug("%i", i);

```

* Исключение 1: Используйте скобки, если родительское выражение состоит из нескольких строк / переносов

```cpp
  // Правильно
  if (address.isEmpty() || !isValid()
      || !codec) {
      return false;
  }
```

* Исключение 2: Симметрия фигурных скобок: используйте фигурные скобки в каждом из if-then-else блоков, если блок if, либо else занимают более одной строчки:

```cpp
 // Неправильно
 if (address.isEmpty())
     qDebug("empty!");
 else {
     qDebug("%s", qPrintable(address));
     it;
 }

 // Правильно
 if (address.isEmpty()) {
     qDebug("empty!");
 } else {
     qDebug("%s", qPrintable(address));
     it;
 }

 // Неправильно
 if (a)
     …
 else
     if (b)
         …

 // Правильно
 if (a) {
     …
 } else {
     if (b)
         …
 }

```

* Используйте фигурные скобки для обозначения пустого тела условия

```cpp
 // Неправильно
 while (a);

 // Правильно
 while (a) {}
```

## Круглые скобки

* Используйте круглые скобки для группировки выражений:

```cpp
 // Неправильно
 if (a && b || c)

 // Правильно
 if ((a && b) || c)

 // Неправильно
 a + b & c

 // Правильно
 (a + b) & c

```

## Использование перечислений enum

* Используйте перечисления с ограниченной областью действия (_enum class_)м- это позволит не захламлять стандартную область видимости и избежать конфликтов именования с другими значениями enum:

```cpp
// ошибки и конфликты
  enum SmallEnum: int16_t {
      A,
      B,  // конфликт с Color::B
      C
  };

  enum Color: int16_t {
      R,
      G,
      B   // конфликт с SmallEnum::B
  };

  double B; // конфликт имен с предыдущими значениями B из enum

// ошибок и конфликтов уже нет
  enum class SmallEnum: int16_t {
      A,
      B,  // конфликтов нет
      C
  };

  enum class Color: int16_t {
      R,
      G,
      B   // конфликтов нет
  };

  double B; // конфликтов нет

```

Каждый элемент enum следует писать с заглавной буквы, а разделитель между элементами [[Qt_coding_style#Разрыв строк| согласно правилу о разрыве строк]] - в конце строки:

```cpp
enum class Dimension {
    First,
    Second,
    Count
};
```

Не указывайте базовый тип enum, если для этого нет особой необходимости. Если его не указывать, то компилятор может выделять оптимальную для производительности память.


## Использование конструкции switch

* Операторы case должны быть в одном столбце со switch
* Каждый оператор case должен иметь закрывающий break (или return) или комментарий(если код не использует Qt фреймворк) или использовать Q_FALLTHROUGH(), начиная с Qt 5.8, который предполагает намеренное отсутствие break или return.

```cpp
 switch (myEnum) {
 case Value1:
   doSomething();
   break;
 case Value2:
 case Value3:
   doSomethingElse();
   Q_FALLTHROUGH();
 default:
   defaultHandling();
   break;
 }
```

## Операторы перехода (break, continue, return и goto)

*  Не ставьте 'else' после операторов перехода:

```cpp
 // Неправильно
 if (thisOrThat)
     return;
 else
     somethingElse();

 // Правильно
 if (thisOrThat)
     return;

 somethingElse();
```

## Разрыв строк

* Длина строки кода не должна превышать 100 символов. Если надо – используйте разрыв строки.

* Запятые помещаются в конец разорванной линии; операторы помещаются в начало новой строки. В зависимости от используемой вами IDE, оператор на конце разорванной строки можно проглядеть.

```cpp
 // Неправильно
 if (longExpression +
     otherLongExpression +
     otherOtherLongExpression) {
 }

 // Правильно
 if (longExpression
     + otherLongExpression
     + otherOtherLongExpression) {
 }
```

## Наследование и ключевое слово `virtual`

* При переопределении virtual-метода, ''ни за что'' не помещайте слово `virtual` в заголовочный файл.

## Главное исключение

* Не бойтесь нарушать описанные выше правила, если вам кажется, что они только запутают ваш код и обсудив это с другими разработчиками проекта.

